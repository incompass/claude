{% extends "base.html" %}

{% block title %}Hookah System{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- –ö–∞—Ç–∞–ª–æ–≥ -->
    <div id="catalog" class="section p-4">
        <div class="gradient-bg text-white p-6 rounded-lg mb-6">
            <h1 class="text-3xl font-bold mb-2 text-center text-main-title">HOOKAH TARGET</h1>
            <p class="opacity-90 font-medium text-lg text-center text-main-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–ª—å—è–Ω –∏ –Ω–∞–ø–∏—Ç–∫–∏ –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –≤–µ—á–µ—Ä–∞</p>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-6 text-center" style="color: var(--primary-color);">–ö–∞–ª—å—è–Ω—ã</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for hookah in hookahs %}
                <div class="bg-white rounded-xl card-shadow overflow-hidden" data-hookah-id="{{ hookah.id }}">
                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–ª—å—è–Ω–∞ -->
                    <div class="relative h-64 overflow-hidden">
                        <img src="{{ url_for('static', filename='photo/' + hookah.name + '.jpg') }}" 
                             alt="{{ hookah.name }}" 
                             class="w-full h-full object-cover">
                        <div class="absolute top-4 right-4">
                            <button onclick="toggleFavorite({{ hookah.id }})" class="heart-icon {% if hookah.id in favorites|map(attribute='id')|list %}active{% endif %} text-white bg-black bg-opacity-30 rounded-full p-2">
                                <i class="fas fa-heart text-xl"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ª—å—è–Ω–µ -->
                    <div class="p-4">
                        <h3 class="font-bold text-xl text-gray-800 mb-2">{{ hookah.name }}</h3>
                        <p class="product-description mb-4">{{ hookah.description }}</p>
                        
                        <button onclick="showHookahModal({{ hookah.id }})" class="w-full btn-add-hookah text-white px-6 py-3 rounded-xl font-semibold">
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-6 text-center" style="color: var(--primary-color);">–ù–∞–ø–∏—Ç–∫–∏</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for drink in drinks %}
                <div class="bg-white rounded-xl card-shadow p-4 glass-card" data-drink-id="{{ drink.id }}">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg text-gray-800">{{ drink.name }}</h3>
                            <p class="font-bold text-2xl" style="color: var(--primary-color);">{{ drink.price }}‚ÇΩ</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="toggleFavorite({{ drink.id }})" class="heart-icon text-gray-400">
                                <i class="fas fa-heart text-2xl"></i>
                            </button>
                            <div class="drink-controls" data-drink-id="{{ drink.id }}">
                                <button onclick="addDrinkToCart({{ drink.id }})" class="btn-primary text-white px-4 py-2 rounded-full add-drink-btn">
                                    –í –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                                <div class="quantity-controls hidden flex items-center gap-2 bg-gray-100 rounded-full px-2 py-1">
                                    <button onclick="updateDrinkInCatalog({{ drink.id }}, -1)" class="text-gray-600 p-1 rounded-full">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display px-3 py-1 font-semibold text-gray-800">0</span>
                                    <button onclick="updateDrinkInCatalog({{ drink.id }}, 1)" class="text-gray-600 p-1 rounded-full">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
    <div id="favorites" class="section hidden p-4">
        <h1 class="text-2xl font-bold mb-6" style="color: var(--primary-color);">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>
        <div id="favorites-content" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>
    
    <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
    <div id="cart" class="section hidden p-4">
        <h1 class="text-2xl font-bold mb-6" style="color: var(--primary-color);">–ö–æ—Ä–∑–∏–Ω–∞</h1>
        
        <div id="cart-items" class="mb-6">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        
        <div id="additional-services" class="bg-white p-4 rounded-lg shadow-md mb-6" style="display: none;">
            <h3 class="font-semibold mb-4 text-gray-800 text-xl">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>
            <div class="space-y-4">
                <!-- –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª—å—è–Ω–∞ —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º -->
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üî•</span>
                        <div>
                            <span class="font-medium text-gray-800 text-lg font-black">–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª—å—è–Ω–∞</span>
                            <p class="text-sm text-gray-600 font-bold">–ú–∞—Å—Ç–µ—Ä –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç –∫–∞–ª—å—è–Ω –¥–ª—è –≤–∞—Å</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold text-pink-600 text-xl">290‚ÇΩ</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="preparation-service" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-pink-600"></div>
                        </label>
                    </div>
                </div>
                
                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—á–∫–∏ —Ç–∞–±–∞–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ + - -->
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">üö¨</span>
                            <div>
                                <span class="font-medium text-gray-800 text-lg font-black">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—á–∫–∏ —Ç–∞–±–∞–∫–∞</span>
                                <p class="text-sm text-gray-600 font-bold">–ü–æ 350‚ÇΩ –∑–∞ –ø–∞—á–∫—É</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600 font-bold">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—á–µ–∫:</span>
                        <div class="flex items-center gap-2 bg-white rounded-full px-2 py-1 border">
                            <button onclick="updateTobaccoQuantity(-1)" class="text-gray-600 hover:text-gray-800 p-1 rounded-full hover:bg-gray-100 transition-colors">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span id="tobacco-quantity" class="px-3 py-1 font-semibold text-gray-800 min-w-[2rem] text-center">0</span>
                            <button onclick="updateTobaccoQuantity(1)" class="text-gray-600 hover:text-gray-800 p-1 rounded-full hover:bg-gray-100 transition-colors">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-right mt-2">
                        <span class="font-bold text-pink-600 text-xl" id="tobacco-total">0‚ÇΩ</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow-md mb-6">
            <div class="flex justify-between items-center text-2xl font-bold">
                <span style="color: var(--primary-color);">–ò—Ç–æ–≥–æ:</span>
                <span id="cart-total" style="color: var(--primary-color);">0‚ÇΩ</span>
            </div>
        </div>
        
        <button onclick="proceedToCheckout()" class="btn-primary text-white w-full py-4 rounded-lg font-semibold text-xl">
            –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
        </button>
    </div>
    
    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="profile" class="section hidden p-4">
        <h1 class="text-2xl font-bold mb-6" style="color: var(--primary-color);">–ü—Ä–æ—Ñ–∏–ª—å</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4" style="color: var(--primary-color);">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
            <div class="space-y-2">
                <p class="font-bold"><strong>–ò–º—è:</strong> {{ user_info.first_name }}</p>
                <p class="font-bold"><strong>–§–∞–º–∏–ª–∏—è:</strong> {{ user_info.last_name }}</p>
                {% if user_info.middle_name %}
                <p class="font-bold"><strong>–û—Ç—á–µ—Å—Ç–≤–æ:</strong> {{ user_info.middle_name }}</p>
                {% endif %}
                <p class="font-bold"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ user_info.phone }}</p>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold" style="color: var(--primary-color);">–ú–æ–∏ –∞–¥—Ä–µ—Å–∞</h2>
                <button onclick="showModal('address-modal')" class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-black">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
            <div id="addresses-list" class="space-y-2">
                {% for address in addresses %}
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded font-bold">
                    <span>{{ address.address }}</span>
                    <button onclick="deleteAddress({{ address.id }})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash text-xl"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-lg font-semibold mb-4">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
            <div id="orders-list">
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞–ª—å—è–Ω–∞ -->
<div id="hookah-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">–í—ã–±–æ—Ä –∫–∞–ª—å—è–Ω–∞</h2>
            <button onclick="hideModal('hookah-modal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="hookah-details">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ -->
<div id="address-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</h2>
            <button onclick="hideModal('address-modal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <form onsubmit="addAddress(event)">
            <input type="text" id="new-address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å" class="w-full p-3 border rounded-lg mb-4" required>
            <button type="submit" class="btn-primary text-white w-full py-3 rounded-lg">
                –î–æ–±–∞–≤–∏—Ç—å
            </button>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
<div id="checkout-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <button onclick="hideModal('checkout-modal')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <form onsubmit="submitOrder(event)">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <input type="date" id="delivery-date" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <input type="time" id="delivery-time" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">–°—Ä–æ–∫ –∞—Ä–µ–Ω–¥—ã (–¥–Ω–∏)</label>
                    <input type="number" id="rental-days" min="1" value="1" class="w-full p-3 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <select id="delivery-address" class="w-full p-3 border rounded-lg" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å</option>
                        {% for address in addresses %}
                        <option value="{{ address.address }}">{{ address.address }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <button type="submit" class="btn-primary text-white w-full py-3 rounded-lg mt-6">
                –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const hookahs = {{ hookahs | tojson }};
    const drinks = {{ drinks | tojson }};
    const fruitPrices = {{ fruit_prices | tojson }};
    
    let currentHookah = null;
    let selectedTariff = null;
    let selectedFruit = null;
    
    function showHookahModal(hookahId) {
        currentHookah = hookahs.find(h => h.id === hookahId);
        if (!currentHookah) return;
        
        const modalContent = document.getElementById('hookah-details');
        modalContent.innerHTML = `
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">${currentHookah.name}</h3>
                <p class="text-gray-600 mb-4">${currentHookah.description}</p>
                
                <div class="mb-6">
                    <h4 class="modal-header">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ:</h4>
                    <div class="space-y-2">
                        <label class="config-option flex items-center" onclick="selectTariffOption('no_tobacco', this)">
                            <input type="radio" name="tariff" value="no_tobacco" onchange="selectTariff('no_tobacco')">
                            <div class="flex-1">
                                <div class="config-title">–ë–µ–∑ —Ç–∞–±–∞–∫–∞</div>
                                <div class="config-description">–∫–∞–ª—å—è–Ω, 3 —É–≥–ª—è, 6 –º—É–Ω–¥—à—Ç—É–∫–æ–≤, –ø–ª–∏—Ç–∞</div>
                            </div>
                            <div class="config-price">${currentHookah.price_no_tobacco}‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectTariffOption('standard', this)">
                            <input type="radio" name="tariff" value="standard" onchange="selectTariff('standard')">
                            <div class="flex-1">
                                <div class="config-title">–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
                                <div class="config-description">–∫–∞–ª—å—è–Ω, 6 —É–≥–ª–µ–π, 6 –º—É–Ω–¥—à—Ç—É–∫–æ–≤, 1 —É–ø–∞–∫–æ–≤–∫–∞ —Ç–∞–±–∞–∫–∞, –ø–ª–∏—Ç–∞</div>
                            </div>
                            <div class="config-price">${currentHookah.price_standard}‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectTariffOption('premium', this)">
                            <input type="radio" name="tariff" value="premium" onchange="selectTariff('premium')">
                            <div class="flex-1">
                                <div class="config-title">–ü—Ä–µ–º–∏—É–º</div>
                                <div class="config-description">–∫–∞–ª—å—è–Ω, 12 —É–≥–ª–µ–π, 6 –º—É–Ω–¥—à—Ç—É–∫–æ–≤, 2 —É–ø–∞–∫–æ–≤–∫–∏ —Ç–∞–±–∞–∫–∞, –ø–ª–∏—Ç–∞</div>
                            </div>
                            <div class="config-price">${currentHookah.price_premium}‚ÇΩ</div>
                        </label>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="modal-header">–§—Ä—É–∫—Ç–æ–≤–∞—è —á–∞—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</h4>
                    <div class="space-y-2">
                        <label class="config-option flex items-center" onclick="selectFruitOption('none', this)">
                            <input type="radio" name="fruit" value="" onchange="selectFruit('')">
                            <div class="flex-1">
                                <div class="config-title">üö´ –ë–µ–∑ —Ñ—Ä—É–∫—Ç–∞</div>
                            </div>
                            <div class="config-price">0‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectFruitOption('apple', this)">
                            <input type="radio" name="fruit" value="apple" onchange="selectFruit('apple')">
                            <div class="flex-1">
                                <div class="config-title">üçé –Ø–±–ª–æ–∫–æ</div>
                            </div>
                            <div class="config-price">+${fruitPrices.apple}‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectFruitOption('orange', this)">
                            <input type="radio" name="fruit" value="orange" onchange="selectFruit('orange')">
                            <div class="flex-1">
                                <div class="config-title">üçä –ê–ø–µ–ª—å—Å–∏–Ω</div>
                            </div>
                            <div class="config-price">+${fruitPrices.orange}‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectFruitOption('grapefruit', this)">
                            <input type="radio" name="fruit" value="grapefruit" onchange="selectFruit('grapefruit')">
                            <div class="flex-1">
                                <div class="config-title">üçã –ì—Ä–µ–π–ø—Ñ—Ä—É—Ç</div>
                            </div>
                            <div class="config-price">+${fruitPrices.grapefruit}‚ÇΩ</div>
                        </label>
                        <label class="config-option flex items-center" onclick="selectFruitOption('pineapple', this)">
                            <input type="radio" name="fruit" value="pineapple" onchange="selectFruit('pineapple')">
                            <div class="flex-1">
                                <div class="config-title">üçç –ê–Ω–∞–Ω–∞—Å</div>
                            </div>
                            <div class="config-price">+${fruitPrices.pineapple}‚ÇΩ</div>
                        </label>
                    </div>
                </div>
                
                <div class="total-display">
                    <div class="text-lg font-semibold">–ò—Ç–æ–≥–æ:</div>
                    <div id="hookah-total" class="total-amount">0‚ÇΩ</div>
                </div>
                
                <button id="add-to-cart-btn" onclick="addHookahToCart()" class="btn-primary w-full py-3 rounded-lg opacity-50 cursor-not-allowed" disabled>
                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </div>
        `;
        
        showModal('hookah-modal');
    }
    
    function selectTariff(tariff) {
        selectedTariff = tariff;
        updateHookahTotal();
        updateAddToCartButton();
    }
    
    function selectTariffOption(tariff, element) {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
        document.querySelectorAll('input[name="tariff"]').forEach(input => {
            input.closest('.config-option').classList.remove('selected');
        });
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞—Ä–∏—Ñ
        element.classList.add('selected');
        element.querySelector('input').checked = true;
        selectTariff(tariff);
    }
    
    function selectFruit(fruit) {
        selectedFruit = fruit;
        updateHookahTotal();
    }
    
    function selectFruitOption(fruit, element) {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —Ñ—Ä—É–∫—Ç–æ–≤
        document.querySelectorAll('input[name="fruit"]').forEach(input => {
            input.closest('.config-option').classList.remove('selected');
        });
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä—É–∫—Ç
        element.classList.add('selected');
        element.querySelector('input').checked = true;
        selectFruit(fruit);
    }
    
    function updateHookahTotal() {
        if (!currentHookah || !selectedTariff) return;
        
        let total = 0;
        switch(selectedTariff) {
            case 'no_tobacco':
                total = currentHookah.price_no_tobacco;
                break;
            case 'standard':
                total = currentHookah.price_standard;
                break;
            case 'premium':
                total = currentHookah.price_premium;
                break;
        }
        
        if (selectedFruit) {
            total += fruitPrices[selectedFruit];
        }
        
        document.getElementById('hookah-total').textContent = `${total}‚ÇΩ`;
    }
    
    function updateAddToCartButton() {
        const btn = document.getElementById('add-to-cart-btn');
        if (selectedTariff) {
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }
    
    function addHookahToCart() {
        if (!currentHookah || !selectedTariff) return;
        
        addToCart(currentHookah.id, selectedTariff, selectedFruit);
        selectedTariff = null;
        selectedFruit = null;
    }
    
    function addAddress(event) {
        event.preventDefault();
        const address = document.getElementById('new-address').value;
        
        fetch(`/{{ telegram_id }}/add_address`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ address: address })
        }).then(() => {
            location.reload();
        });
    }
    
    function deleteAddress(addressId) {
        fetch(`/{{ telegram_id }}/delete_address`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ address_id: addressId })
        }).then(() => {
            location.reload();
        });
    }
    
    function proceedToCheckout() {
        showModal('checkout-modal');
    }
    
    function submitOrder(event) {
        event.preventDefault();
        
        const orderData = {
            delivery_date: document.getElementById('delivery-date').value,
            delivery_time: document.getElementById('delivery-time').value,
            rental_days: parseInt(document.getElementById('rental-days').value),
            address: document.getElementById('delivery-address').value,
            preparation_service: document.getElementById('preparation-service').checked,
            additional_tobacco: parseInt(document.getElementById('additional-tobacco').value) || 0
        };
        
        fetch(`/{{ telegram_id }}/create_order`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(orderData)
        }).then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = `/{{ telegram_id }}/${data.order_number}`;
            }
        });
    }
    
    function loadOrders() {
        fetch(`/{{ telegram_id }}/orders`)
            .then(response => response.json())
            .then(orders => {
                const ordersList = document.getElementById('orders-list');
                ordersList.innerHTML = '';
                
                orders.forEach(order => {
                    const orderElement = document.createElement('div');
                    orderElement.className = 'p-3 border rounded-lg mb-3';
                    orderElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold">–ó–∞–∫–∞–∑ #${order.order_number}</div>
                                <div class="text-sm text-gray-600">${order.delivery_date} –≤ ${order.delivery_time}</div>
                                <div class="text-sm text-gray-600">–°—Ç–∞—Ç—É—Å: ${order.status}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-purple-600">${order.total_price}‚ÇΩ</div>
                                <a href="/{{ telegram_id }}/${order.order_number}" class="text-blue-500 text-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            </div>
                        </div>
                    `;
                    ordersList.appendChild(orderElement);
                });
            });
    }
    
    function removeFromCart(type, cartId) {
        fetch(`/{{ telegram_id }}/remove_from_cart`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ type: type, cart_id: cartId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
                updateCartDisplay();
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
            }
        })
        .catch(error => {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞', 'error');
        });
    }
    
    function updateDrinkQuantity(cartId, newQuantity) {
        if (newQuantity < 1) {
            removeFromCart('drink', cartId);
            return;
        }
        
        fetch(`/{{ telegram_id }}/update_drink_quantity`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ cart_id: cartId, quantity: newQuantity })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateCartDisplay();
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞', 'error');
            }
        })
        .catch(error => {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞', 'error');
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadOrders();
    });
</script>
{% endblock %} 